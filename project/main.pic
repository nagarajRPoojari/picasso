import syncio from builtin;
import sync from builtin;
import array from builtin;
import types from builtin;
import asyncio from builtin;

import crypto from builtin;

class Node {
    say key: string;
    say val: int;
    say next: Node;

    fn Node(key: string, val: int) {
        this.key = key;
        this.val = val;
        this.next = null;
    }
}

class HashMap {
    say arr: []Node;
    say size: int;

    say n: Node;
    fn HashMap(size: int) {
        this.size = size;
        this.arr = array.create(Node, size);
        this.n = new Node("a", 10);

        syncio.printf("n = > %p %d \n", this, this.size);
    }

    fn put(k: string, v: int) {
        say h: int = crypto.hash(k, types.size(k));
        say i: int = h % this.size;

        if(this.arr[i] == null){
            this.arr[i] = new Node(k,v);
        }else { 
            say head: Node = this.arr[i];

            while head != null {
                if(head.next == null) {
                    head.next = new Node(k,v);
                    return;
                }
                head = head.next;
            }
        }
    }

    fn get(k: string): int {
        say h: int = crypto.hash(k, types.size(k));
        say i: int = h % this.size;

        say head: Node = this.arr[i];
        while head != null {
            syncio.printf("head.key = %p, %s \n", head.key, head.key);
            if(strcmp(head.key, k) == 0){
                return head.val;
            }
            head = head.next;
        }
        return -1;
    }
}

fn start() {
    say h:HashMap;
    h = new HashMap(10);
    h.put("hi", 1163);
    h.put("hello", 90);
    h.put("abc", 77);


    syncio.printf("=> %d \n", h.get("abc"));

}