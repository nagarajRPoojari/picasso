import io from builtin;
import array from builtin;
import sync from builtin;

class Worker {
    say counter: atomic int;
    say _thread_id: int;
    fn Worker(count: int) {
        sync.atomic_store(this.counter, count);
    } 

    fn do() {
        this._thread_id = this._thread_id + 1;
        this.recurse(this._thread_id);
    }

    fn recurse(id: int) {
        say c: int = sync.atomic_load(this.counter);
        if(c < 0) {
            return;
        }else {
            io.printf("[%d] step - %d \n", id, c);
            sync.atomic_sub(this.counter, 1);
            this.recurse(id);
        }
    }
}


fn start() {
    say w1: Worker = new Worker(1000);
    thread(w1.do);
    thread(w1.do);
}