using "builtin/syncio";
using "builtin/types";
using "builtin/sync";

class A {
    fn A() {

    }

    fn hello() {
        syncio.printf("hello\n");
    }
}

class Test {
    say oddMu: mutex;
    say evenMu: mutex;
    say n: int;

    fn Test(h: start.A, n: int, x: int) {
        h.hello();
        syncio.printf("value of n: %d , %d\n", n, x);
        // syncio.printf("oddMu: %p \n", oddMu);

        // this.oddMu = oddMu;
        // this.evenMu = evenMu;
        this.n = n;
    }
}

fn start() {
    say oddMu: mutex  = sync.mutex_create();
    say evenMu: mutex = sync.mutex_create();

    say t: start.Test = new start.Test(new start.A(),100, 45);
}


// ; ModuleID = '/private/var/tmp/_bazel_nagarajpoojari/307cc1743f706d9fb09b159f72a36871/execroot/_main/bazel-out/darwin_arm64-fastbuild/bin/cli/picasso.runfiles/_main/libs/sync/ffi_stub.c'
// source_filename = "/private/var/tmp/_bazel_nagarajpoojari/307cc1743f706d9fb09b159f72a36871/execroot/_main/bazel-out/darwin_arm64-fastbuild/bin/cli/picasso.runfiles/_main/libs/sync/ffi_stub.c"
// target datalayout = "e-m:o-i64:64-i128:128-n32:64-S128"
// target triple = "arm64-apple-macosx15.0.0"

// %struct.__public__rwmutex = type { i64, %struct._opaque_pthread_mutex_t, %struct.safe_queue_t, %struct.safe_queue_t }
// %struct._opaque_pthread_mutex_t = type { i64, [56 x i8] }
// %struct.safe_queue_t = type { i32, %struct.task_node*, %struct.task_node*, %struct._opaque_pthread_mutex_t, %struct._opaque_pthread_cond_t }
// %struct.task_node = type { %struct.task*, %struct.task_node* }
// %struct.task = type { i32, %struct.platform_ctx, i64, i32, i8* (i8*)*, i8*, i32, %struct.io_metadata_t, %struct.wait_q_metadata*, %struct.wait_q_metadata* }
// %struct.platform_ctx = type { %struct.registers_t, i8*, i64, %struct.platform_ctx_t* }
// %struct.registers_t = type { [12 x i64], i64 }
// %struct.platform_ctx_t = type opaque
// %struct.io_metadata_t = type { i32, i8*, i64, i64, i64, i32, i32, i32, %struct.sockaddr*, i32* }
// %struct.sockaddr = type { i8, i8, [14 x i8] }
// %struct.wait_q_metadata = type { %struct.wait_q_metadata*, %struct.wait_q_metadata*, %struct.task* }
// %struct._opaque_pthread_cond_t = type { i64, [40 x i8] }
// %struct.__public__mutex = type { i64, %struct._opaque_pthread_mutex_t, %struct.safe_queue_t }

// @__ffi_force = global [8 x i8*] [i8* bitcast (%struct.__public__rwmutex* (...)* @__public__sync_rwmutex_create to i8*), i8* bitcast (void (%struct.__public__rwmutex*)* @__public__sync_rwmutex_rlock to i8*), i8* bitcast (void (%struct.__public__rwmutex*)* @__public__sync_rwmutex_rwlock to i8*), i8* bitcast (void (%struct.__public__rwmutex*)* @__public__sync_rwmutex_runlock to i8*), i8* bitcast (void (%struct.__public__rwmutex*)* @__public__sync_rwmutex_rwunlock to i8*), i8* bitcast (%struct.__public__mutex* ()* @__public__sync_mutex_create to i8*), i8* bitcast (void (%struct.__public__mutex*)* @__public__sync_mutex_lock to i8*), i8* bitcast (void (%struct.__public__mutex*)* @__public__sync_mutex_unlock to i8*)], align 8, !dbg !0

// declare %struct.__public__rwmutex* @__public__sync_rwmutex_create(...) #0

// declare void @__public__sync_rwmutex_rlock(%struct.__public__rwmutex* noundef) #0

// declare void @__public__sync_rwmutex_rwlock(%struct.__public__rwmutex* noundef) #0

// declare void @__public__sync_rwmutex_runlock(%struct.__public__rwmutex* noundef) #0

// declare void @__public__sync_rwmutex_rwunlock(%struct.__public__rwmutex* noundef) #0

// declare %struct.__public__mutex* @__public__sync_mutex_create() #0

// declare void @__public__sync_mutex_lock(%struct.__public__mutex* noundef) #0

// declare void @__public__sync_mutex_unlock(%struct.__public__mutex* noundef) #0

// attributes #0 = { "frame-pointer"="non-leaf" "no-trapping-math"="true" "stack-protector-buffer-size"="8" "target-cpu"="apple-m1" "target-features"="+aes,+crc,+crypto,+dotprod,+fp-armv8,+fp16fml,+fullfp16,+lse,+neon,+ras,+rcpc,+rdm,+sha2,+v8.5a,+zcm,+zcz" }

// !llvm.dbg.cu = !{!2}
// !llvm.module.flags = !{!10, !11, !12, !13, !14, !15, !16, !17, !18, !19}
// !llvm.ident = !{!20}

// !0 = !DIGlobalVariableExpression(var: !1, expr: !DIExpression())
// !1 = distinct !DIGlobalVariable(name: "__ffi_force", scope: !2, file: !5, line: 4, type: !6, isLocal: false, isDefinition: true)
// !2 = distinct !DICompileUnit(language: DW_LANG_C99, file: !3, producer: "Homebrew clang version 14.0.6", isOptimized: false, runtimeVersion: 0, emissionKind: FullDebug, globals: !4, splitDebugInlining: false, nameTableKind: None, sysroot: "/Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk", sdk: "MacOSX14.sdk")
// !3 = !DIFile(filename: "/private/var/tmp/_bazel_nagarajpoojari/307cc1743f706d9fb09b159f72a36871/execroot/_main/bazel-out/darwin_arm64-fastbuild/bin/cli/picasso.runfiles/_main/libs/sync/ffi_stub.c", directory: "/private/var/tmp/_bazel_nagarajpoojari/307cc1743f706d9fb09b159f72a36871/execroot/_main/bazel-out/darwin_arm64-fastbuild/bin/cli/picasso.runfiles/_main")
// !4 = !{!0}
// !5 = !DIFile(filename: "libs/sync/ffi_stub.c", directory: "/private/var/tmp/_bazel_nagarajpoojari/307cc1743f706d9fb09b159f72a36871/execroot/_main/bazel-out/darwin_arm64-fastbuild/bin/cli/picasso.runfiles/_main")
// !6 = !DICompositeType(tag: DW_TAG_array_type, baseType: !7, size: 512, elements: !8)
// !7 = !DIDerivedType(tag: DW_TAG_pointer_type, baseType: null, size: 64)
// !8 = !{!9}
// !9 = !DISubrange(count: 8)
// !10 = !{i32 7, !"Dwarf Version", i32 4}
// !11 = !{i32 2, !"Debug Info Version", i32 3}
// !12 = !{i32 1, !"wchar_size", i32 4}
// !13 = !{i32 1, !"branch-target-enforcement", i32 0}
// !14 = !{i32 1, !"sign-return-address", i32 0}
// !15 = !{i32 1, !"sign-return-address-all", i32 0}
// !16 = !{i32 1, !"sign-return-address-with-bkey", i32 0}
// !17 = !{i32 7, !"PIC Level", i32 2}
// !18 = !{i32 7, !"uwtable", i32 1}
// !19 = !{i32 7, !"frame-pointer", i32 1}
// !20 = !{!"Homebrew clang version 14.0.6"}
