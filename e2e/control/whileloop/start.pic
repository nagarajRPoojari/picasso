using "builtin/syncio";

class Test {
    fn Test() {}

    // Basic while loop 
    fn testSimpleWhile() {
        say i:int = 0;
        while (i < 5) {
            syncio.printf("W:%d;", i);
            i = i + 1;
        }
        syncio.printf("\n");
    }

    // Zero-iteration case 
    fn testZeroIteration() {
        say i:int = 5;
        while (i < 5) {
            syncio.printf("SHOULD_NOT_PRINT");
            i = i + 1;
        }
        syncio.printf("ZERO_OK\n");
    }

    // While with if / else-if ladder inside 
    fn testWhileWithIf() {
        say i:int = -2;
        while (i <= 2) {
            if (i < 0) {
                syncio.printf("NEG:%d;", i);
            } else if (i == 0) {
                syncio.printf("ZERO;");
            } else {
                syncio.printf("POS:%d;", i);
            }
            i = i + 1;
        }
        syncio.printf("\n");
    }

    // Nested while loops 
    fn testNestedWhile() {
        say i:int = 0;
        while (i < 3) {
            say j:int = 0;
            while (j < 3) {
                syncio.printf("(%d,%d);", i, j);
                j = j + 1;
            }
            i = i + 1;
        }
        syncio.printf("\n");
    }

    // Condition with function call 
    fn isLess(a:int, b:int): boolean {
        return a < b;
    }

    fn testWhileWithCall() {
        say i:int = 0;
        while (this.isLess(i, 3)) {
            syncio.printf("C:%d;", i);
            i = i + 1;
        }
        syncio.printf("\n");
    }

    // State mutation correctness 
    fn testMutation() {
        say i:int = 1;
        say acc:int = 1;

        while (i <= 5) {
            acc = acc * i;
            i = i + 1;
        }
        syncio.printf("FACT=%d\n", acc); // 120
    }
}

fn start() {
    say t: start.Test = new start.Test();

    t.testSimpleWhile();     // W:0;W:1;W:2;W:3;W:4;
    t.testZeroIteration();  // ZERO_OK
    t.testWhileWithIf();    // NEG:-2;NEG:-1;ZERO;POS:1;POS:2;
    t.testNestedWhile();    // (0,0)...(2,2)
    t.testWhileWithCall();  // C:0;C:1;C:2;
    t.testMutation();       // FACT=120
}
